define("tiny_ubicast/commands",["exports","./common","editor_tiny/utils","core/str","./options"],(function(_exports,_common,_utils,_str,_options){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.create_video_link=create_video_link,_exports.getSetup=void 0;function create_video_link(course_id,use_filter,ubicast_url){const media_id=document.getElementById("id_mediaid").value,media_width=document.getElementById("id_mediawidth").value,media_height=document.getElementById("id_mediaheight").value,media_thumb=document.getElementById("id_mediaimg").value||"/static/mediaserver/images/video.svg";let video_url="";if(media_id)if(use_filter){video_url='<img class="tiny_ubicast courseid_'+course_id+"_mediaid_"+media_id+'" style="display: block; width: '+media_width+"; height: "+media_height+';" src="'+(ubicast_url+media_thumb)+'" alt=""/>'}else{const url="/lib/editor/tiny/plugins/ubicast/view.php?course="+course_id+" &video= + "+media_id;video_url='<iframe class="nudgis-iframe" style="width:'+media_width+"; height: "+media_height+'; background-color: #ddd;" src="'+window.M.cfg.wwwroot+url+'"  allow="autoplay; encrypted-media" allowfullscreen="allowfullscreen"></iframe>'}return video_url}_exports.getSetup=async()=>{const[insertButtonName,buttonImage]=await Promise.all([(0,_str.get_string)("inputsubmit",_common.component),(0,_utils.getButtonImage)("icon",_common.component)]);return editor=>{editor.ui.registry.addIcon(_common.icon,buttonImage.html),editor.ui.registry.addButton("insert_media",{icon:_common.icon,tooltip:insertButtonName,onAction:()=>async function(editor){const courseid=(0,_options.getCourseId)(editor),usefilter="1"===(0,_options.useFilter)(editor),ubicastURL=(0,_options.getUbicastURL)(editor),[panelTitle]=await Promise.all([(0,_str.get_string)("pluginname",_common.component)]),xhttp=new XMLHttpRequest;xhttp.onreadystatechange=function(){if(4===this.readyState&&200===this.status){const form_id="id_resource_tiny_ubicast_"+(new Date).getTime(),content=document.createElement("div");content.innerHTML=this.responseText,content.querySelector("form").id=form_id,editor.windowManager.open({title:panelTitle,body:{type:"panel",items:[{type:"htmlpanel",html:'<div id="ubicast_content"></div>'}]},buttons:[{type:"cancel",text:"Close"},{type:"submit",text:"Save",buttonType:"primary"}],onSubmit:api=>{const video_link=create_video_link(courseid,usefilter,ubicastURL);editor.insertContent(video_link),api.close()}}),document.getElementById("ubicast_content").appendChild(content),setTimeout((function(){window.mediaSelector=new window.MediaSelector({moodleURL:window.M.cfg.wwwroot+"/mod/ubicast/lti.php?id="+courseid,nudgisURL:ubicastURL,filterBySpeaker:!0,target:form_id})}),window.MediaSelector?10:2e3)}},xhttp.open("GET",window.M.cfg.wwwroot+"/lib/editor/tiny/plugins/ubicast/media.php",!0),xhttp.send()}(editor)})}}}));

//# sourceMappingURL=commands.min.js.map