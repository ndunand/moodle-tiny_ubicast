{"version":3,"file":"commands.min.js","sources":["../src/commands.js"],"sourcesContent":["import {getCourseId, getUbicastURL, useFilter} from \"./options\";\n/**\n * Add a correction on the current selection.\n * @param {tinyMCE} editor\n * @returns {void}\n */\nfunction insertMedia(editor) {\n\n    const courseid = getCourseId(editor);\n    const usefilter = useFilter(editor) === '1';\n    const ubicastURL = getUbicastURL(editor);\n\n    const xhttp = new XMLHttpRequest();\n    xhttp.onreadystatechange = function () {\n        if (this.readyState === 4 && this.status === 200) {\n            //Create iframe content\n            const formId = 'id_resource_atto_ubicast_' + new Date().getTime();\n            const content = Y.Node.create(this.responseText);\n            content.set('id', formId);\n            const fieldset = content.one('fieldset');\n            if (fieldset) {\n                // The fieldset can be null with Moodle < 4.0\n                fieldset.setStyle('overflow', 'auto');\n                fieldset.setStyle('padding', '20px');\n                fieldset.setStyle('max-height', 0.7 * window.innerHeight);\n            }\n\n            editor.windowManager.open({\n                //TODO replace title\n                title: 'Example plugin',\n                body: {\n                    type: 'panel',\n                    items: [\n                        {\n                            type: 'htmlpanel',\n                            html: '<div id=\"content\"></div>'\n                        },\n                    ]\n                },\n                buttons: [\n                    {\n                        type: 'cancel',\n                        text: 'Close'\n                    },\n                    {\n                        type: 'submit',\n                        text: 'Save',\n                        buttonType: 'primary'\n                    }\n                ],\n                onSubmit: (api) => {\n                    const video_link = create_video_link(courseid, usefilter, ubicastURL);\n                    editor.insertContent(video_link);\n                    api.close();\n                }\n            });\n            Y.one('#content').insert(content, 'after');\n            setTimeout(function () {\n                // Use setTimeout to wait for MediaSelector loading.\n                window.mediaSelector = new window.MediaSelector({\n                    moodleURL: window.M.cfg.wwwroot + '/mod/ubicast/lti.php?id=' + courseid,\n                    nudgisURL: ubicastURL,\n                    filterBySpeaker: true,\n                    target: formId\n                });\n            }, (window.MediaSelector ? 10 : 2000));\n        }\n    };\n    xhttp.open('GET', window.M.cfg.wwwroot + '/lib/editor/atto/plugins/ubicast/media.php', true);\n    xhttp.send();\n}\n\n\nexport const getSetup = async () => {\n    return (editor) => {\n\n        // Register the insert media Toolbar Button.\n        editor.ui.registry.addButton('insert_media', {\n            icon: 'user',\n            tooltip: \"Insert media\",\n            onAction: () => insertMedia(editor)\n        });\n    };\n};\n\n/**\n * Function to retrieve the course id from the current page.\n *\n * @method create_video_link\n * @param {number} course_id The course id.\n * @param {boolean} use_filter The use filter option.\n * @param {string} ubicast_url The ubicast url.\n * @return {string} The cource id.\n * @private\n */\nexport function create_video_link(course_id, use_filter, ubicast_url) {\n\n    const media_id = document.getElementById('id_mediaid').value;\n    const media_width = document.getElementById('id_mediawidth').value;\n    const media_height = document.getElementById('id_mediaheight').value;\n    const media_thumb = document.getElementById('id_mediaimg').value || '/static/mediaserver/images/video.svg';\n\n    let video_url = '';\n    if (media_id) {\n        if (use_filter) {\n            const thumb_url = ubicast_url + media_thumb;\n            video_url = '<img class=\"atto_ubicast courseid_' + course_id + '_mediaid_'\n                + media_id + '\" style=\"display: block; width: '\n                + media_width + '; height: ' + media_height + ' }};\"' + ' src=\"' + thumb_url + '\" alt=\"\"/>';\n        } else {\n            const url = '/lib/editor/atto/plugins/ubicast/view.php?course=' + course_id + ' &video= + ' + media_id;\n            video_url = '<iframe class=\"nudgis-iframe\" ' +\n                'style=\"width:' + media_width + '; height: ' + media_height + '; background-color: #ddd;\" ' +\n                'src=\"' + window.M.cfg.wwwroot + url + '\" ' +\n                ' allow=\"autoplay; encrypted-media\" allowfullscreen=\"allowfullscreen\">' +\n                '</iframe>';\n        }\n    }\n\n    return video_url;\n}"],"names":["create_video_link","course_id","use_filter","ubicast_url","media_id","document","getElementById","value","media_width","media_height","media_thumb","video_url","url","window","M","cfg","wwwroot","async","editor","ui","registry","addButton","icon","tooltip","onAction","courseid","usefilter","ubicastURL","xhttp","XMLHttpRequest","onreadystatechange","this","readyState","status","formId","Date","getTime","content","Y","Node","create","responseText","set","fieldset","one","setStyle","innerHeight","windowManager","open","title","body","type","items","html","buttons","text","buttonType","onSubmit","api","video_link","insertContent","close","insert","setTimeout","mediaSelector","MediaSelector","moodleURL","nudgisURL","filterBySpeaker","target","send","insertMedia"],"mappings":"2NA+FgBA,kBAAkBC,UAAWC,WAAYC,mBAE/CC,SAAWC,SAASC,eAAe,cAAcC,MACjDC,YAAcH,SAASC,eAAe,iBAAiBC,MACvDE,aAAeJ,SAASC,eAAe,kBAAkBC,MACzDG,YAAcL,SAASC,eAAe,eAAeC,OAAS,2CAEhEI,UAAY,MACZP,YACIF,WAAY,CAEZS,UAAY,qCAAuCV,UAAY,YACzDG,SAAW,mCACXI,YAAc,aAAeC,aAFvB,eADMN,YAAcO,aAGmD,iBAChF,OACGE,IAAM,oDAAsDX,UAAY,cAAgBG,SAC9FO,UAAY,8CACUH,YAAc,aAAeC,aADvC,mCAEEI,OAAOC,EAAEC,IAAIC,QAAUJ,IAFzB,0FAQbD,4BA9CaM,SACZC,SAGJA,OAAOC,GAAGC,SAASC,UAAU,eAAgB,CACzCC,KAAM,OACNC,QAAS,eACTC,SAAU,aA1EDN,cAEXO,UAAW,wBAAYP,QACvBQ,UAAkC,OAAtB,sBAAUR,QACtBS,YAAa,0BAAcT,QAE3BU,MAAQ,IAAIC,eAClBD,MAAME,mBAAqB,cACC,IAApBC,KAAKC,YAAoC,MAAhBD,KAAKE,OAAgB,OAExCC,OAAS,6BAA8B,IAAIC,MAAOC,UAClDC,QAAUC,EAAEC,KAAKC,OAAOT,KAAKU,cACnCJ,QAAQK,IAAI,KAAMR,cACZS,SAAWN,QAAQO,IAAI,YACzBD,WAEAA,SAASE,SAAS,WAAY,QAC9BF,SAASE,SAAS,UAAW,QAC7BF,SAASE,SAAS,aAAc,GAAMhC,OAAOiC,cAGjD5B,OAAO6B,cAAcC,KAAK,CAEtBC,MAAO,iBACPC,KAAM,CACFC,KAAM,QACNC,MAAO,CACH,CACID,KAAM,YACNE,KAAM,8BAIlBC,QAAS,CACL,CACIH,KAAM,SACNI,KAAM,SAEV,CACIJ,KAAM,SACNI,KAAM,OACNC,WAAY,YAGpBC,SAAWC,YACDC,WAAa3D,kBAAkByB,SAAUC,UAAWC,YAC1DT,OAAO0C,cAAcD,YACrBD,IAAIG,WAGZvB,EAAEM,IAAI,YAAYkB,OAAOzB,QAAS,SAClC0B,YAAW,WAEPlD,OAAOmD,cAAgB,IAAInD,OAAOoD,cAAc,CAC5CC,UAAWrD,OAAOC,EAAEC,IAAIC,QAAU,2BAA6BS,SAC/D0C,UAAWxC,WACXyC,iBAAiB,EACjBC,OAAQnC,WAEZrB,OAAOoD,cAAgB,GAAK,OAGxCrC,MAAMoB,KAAK,MAAOnC,OAAOC,EAAEC,IAAIC,QAAU,8CAA8C,GACvFY,MAAM0C,OAWkBC,CAAYrD"}