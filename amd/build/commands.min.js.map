{"version":3,"file":"commands.min.js","sources":["../src/commands.js"],"sourcesContent":["/**\n * Add a correction on the current selection.\n * @param {editor} editor\n * @returns {void}\n */\nfunction insertMedia(editor) {\n\n    //get course id value from the current url\n    const urlParams = new URLSearchParams(window.location.search);\n    const course_id = parseInt(urlParams.get('course'));\n\n    const xhttp = new XMLHttpRequest();\n    xhttp.onreadystatechange = function () {\n        if (this.readyState === 4 && this.status === 200) {\n            //Create iframe content\n\n            const formId = 'id_resource_atto_ubicast_' + new Date().getTime();\n            const content = Y.Node.create(this.responseText);\n            content.set('id', formId);\n            /*const bottom = Y.Node.create('<div style=\"text-align: center;\"></div>');\n            const submit = 'Insert';\n            bottom.append(Y.Node.create('<button type=\"submit\" class=\"btn btn-primary\">' + submit + '</button>'));\n            content.append(bottom);\n            content.on('submit', setVideo, self);*/\n            const fieldset = content.one('fieldset');\n            if (fieldset) {\n                // The fieldset can be null with Moodle < 4.0\n                fieldset.setStyle('overflow', 'auto');\n                fieldset.setStyle('padding', '20px');\n                fieldset.setStyle('max-height', 0.7 * window.innerHeight);\n            }\n\n            editor.windowManager.open({\n                title: 'Example plugin',\n                body: {\n                    type: 'panel',\n                    items: [\n                        {\n                            type: 'htmlpanel', // component type\n                            html: '<div id=\"content\"></div>'\n                        },\n                    ]\n                },\n                buttons: [\n                    {\n                        type: 'cancel',\n                        text: 'Close'\n                    },\n                    {\n                        type: 'submit',\n                        text: 'Save',\n                        buttonType: 'primary'\n                    }\n                ],\n                onSubmit: (api) => {\n                    const video_link = create_video_link(course_id);\n                    editor.insertContent(video_link);\n                    api.close();\n                }\n            });\n            Y.one('#content').insert(content, 'after');\n            setTimeout(function () {\n                // Use setTimeout to wait for MediaSelector loading.\n                window.mediaSelector = new window.MediaSelector({\n                    moodleURL: window.M.cfg.wwwroot + '/mod/ubicast/lti.php?id=' + course_id,\n                    //TODO config\n                    nudgisURL: 'https://tstrec.unil.ch',\n                    filterBySpeaker: true,\n                    target: formId\n                });\n            }, (window.MediaSelector ? 10 : 2000));\n        }\n    };\n    xhttp.open('GET', window.M.cfg.wwwroot + '/lib/editor/atto/plugins/ubicast/media.php', true);\n    xhttp.send();\n}\n\n\nexport const getSetup = async () => {\n    return (editor) => {\n\n        // Register the insert media Toolbar Button.\n        editor.ui.registry.addButton('insert_media', {\n            icon: 'user',\n            tooltip: \"Insert media\",\n            onAction: () => insertMedia(editor)\n        });\n    };\n};\n\n/**\n * Function to retrieve the course id from the current page.\n *\n * @method create_video_link\n * @param {string} course_id The course id.\n * @return {string} The cource id.\n * @private\n */\nexport function create_video_link(course_id) {\n\n    const media_id = document.getElementById('id_mediaid').value;\n    const media_width = document.getElementById('id_mediawidth').value;\n    const media_height = document.getElementById('id_mediaheight').value;\n    const media_thumb = document.getElementById('id_mediaimg').value || '/static/mediaserver/images/video.svg';\n\n    //TODO get values\n    const use_filter = false;\n    const ubicast_url = 'https://tstrec.unil.ch';\n\n    let video_url = '';\n    if (media_id) {\n        if (use_filter) {\n            const thumb_url = ubicast_url + media_thumb;\n            video_url = '<img class=\"atto_ubicast courseid_' + course_id + '_mediaid_'\n                + media_id + '\" style=\"display: block; width: '\n                + media_width + '; height: ' + media_height + ' }};\"' + ' src=\"' + thumb_url + '\" alt=\"\"/>';\n        } else {\n            const url = '/lib/editor/atto/plugins/ubicast/view.php?course=' + course_id + ' &video= + ' + media_id;\n            video_url = '<iframe class=\"nudgis-iframe\" ' +\n                'style=\"width:' + media_width + '; height: ' + media_height + '; background-color: #ddd;\" ' +\n                'src=\"' + window.M.cfg.wwwroot + url + '\" ' +\n                ' allow=\"autoplay; encrypted-media\" allowfullscreen=\"allowfullscreen\">' +\n                '</iframe>';\n        }\n    }\n\n    return video_url;\n}"],"names":["create_video_link","course_id","media_id","document","getElementById","value","media_width","media_height","video_url","url","window","M","cfg","wwwroot","async","editor","ui","registry","addButton","icon","tooltip","onAction","urlParams","URLSearchParams","location","search","parseInt","get","xhttp","XMLHttpRequest","onreadystatechange","this","readyState","status","formId","Date","getTime","content","Y","Node","create","responseText","set","fieldset","one","setStyle","innerHeight","windowManager","open","title","body","type","items","html","buttons","text","buttonType","onSubmit","api","video_link","insertContent","close","insert","setTimeout","mediaSelector","MediaSelector","moodleURL","nudgisURL","filterBySpeaker","target","send","insertMedia"],"mappings":"sMAkGgBA,kBAAkBC,iBAExBC,SAAWC,SAASC,eAAe,cAAcC,MACjDC,YAAcH,SAASC,eAAe,iBAAiBC,MACvDE,aAAeJ,SAASC,eAAe,kBAAkBC,MAC3CF,SAASC,eAAe,eAAeC,UAMvDG,UAAY,MACZN,SAMO,OACGO,IAAM,oDAAsDR,UAAY,cAAgBC,SAC9FM,UAAY,8CACUF,YAAc,aAAeC,aADvC,mCAEEG,OAAOC,EAAEC,IAAIC,QAAUJ,IAFzB,0FAQbD,4BAhDaM,SACZC,SAGJA,OAAOC,GAAGC,SAASC,UAAU,eAAgB,CACzCC,KAAM,OACNC,QAAS,eACTC,SAAU,aAhFDN,cAGXO,UAAY,IAAIC,gBAAgBb,OAAOc,SAASC,QAChDxB,UAAYyB,SAASJ,UAAUK,IAAI,WAEnCC,MAAQ,IAAIC,eAClBD,MAAME,mBAAqB,cACC,IAApBC,KAAKC,YAAoC,MAAhBD,KAAKE,OAAgB,OAGxCC,OAAS,6BAA8B,IAAIC,MAAOC,UAClDC,QAAUC,EAAEC,KAAKC,OAAOT,KAAKU,cACnCJ,QAAQK,IAAI,KAAMR,cAMZS,SAAWN,QAAQO,IAAI,YACzBD,WAEAA,SAASE,SAAS,WAAY,QAC9BF,SAASE,SAAS,UAAW,QAC7BF,SAASE,SAAS,aAAc,GAAMnC,OAAOoC,cAGjD/B,OAAOgC,cAAcC,KAAK,CACtBC,MAAO,iBACPC,KAAM,CACFC,KAAM,QACNC,MAAO,CACH,CACID,KAAM,YACNE,KAAM,8BAIlBC,QAAS,CACL,CACIH,KAAM,SACNI,KAAM,SAEV,CACIJ,KAAM,SACNI,KAAM,OACNC,WAAY,YAGpBC,SAAWC,YACDC,WAAa3D,kBAAkBC,WACrCc,OAAO6C,cAAcD,YACrBD,IAAIG,WAGZvB,EAAEM,IAAI,YAAYkB,OAAOzB,QAAS,SAClC0B,YAAW,WAEPrD,OAAOsD,cAAgB,IAAItD,OAAOuD,cAAc,CAC5CC,UAAWxD,OAAOC,EAAEC,IAAIC,QAAU,2BAA6BZ,UAE/DkE,UAAW,yBACXC,iBAAiB,EACjBC,OAAQnC,WAEZxB,OAAOuD,cAAgB,GAAK,OAGxCrC,MAAMoB,KAAK,MAAOtC,OAAOC,EAAEC,IAAIC,QAAU,8CAA8C,GACvFe,MAAM0C,OAWkBC,CAAYxD"}